<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AISI协议解析网关</title>
    <style>
        /* 保留原有样式，仅修改内容 */
    </style>
</head>
<body>
    <div class="container">
        <h1>AISI协议解析网关</h1>
        <p>将 aisi:// 协议地址解析为实际可访问的网页服务</p>
        
        <h2>输入AISI协议地址</h2>
        <div class="input-group">
            <input type="text" id="uri-input" 
                   placeholder="例如：aisi://AISI/Weather-001?city=北京">
            <button onclick="resolveProtocol()">解析</button>
        </div>

        <div class="examples">
            <h3>可用示例：</h3>
            <ul>
                <li><code>aisi://AISI/Weather-001?city=北京</code>（天气查询）</li>
                <li><code>aisi://AISI/IP-Info-001?ip=8.8.8.8</code>（IP地理信息）</li>
                <li><code>aisi://AISI/Holiday-CN-001?date=2026-01-22</code>（节假日）</li>
            </ul>
            <h3>开发者服务：</h3>
            <ul>
                <li><code>aisi://TanChong/AISI-Meta-001</code>（表单创建指南）</li>
                <li><code>aisi://TanChong/AISI-Travel-001</code>（深圳旅行清单）</li>
            </ul>
            <p><small>注：开发者服务可能处于维护状态，标准服务保证可用</small></p>
        </div>

        <div id="result" style="display:none;">
            <h3>解析结果</h3>
            <pre id="result-content"></pre>
            <button onclick="goBack()">返回</button>
        </div>

        <div id="error" style="display:none;">
            <h3>解析失败</h3>
            <p id="error-message"></p>
            <button onclick="retry()">重试</button>
            <button onclick="goHome()">返回首页</button>
        </div>
    </div>

    <footer>
        <p>AISI Protocol Gateway v1.2 | AI原子服务互联网</p>
        <p>网关将 aisi:// 协议转换为实际网页访问</p>
        <p><a href="https://aisi-protocol.github.io/aisi-portal/">aisi-protocol.github.io</a></p>
    </footer>

    <script>
        // 修复后的JavaScript代码（已验证）
        async function resolveProtocol() {
            const uri = document.getElementById('uri-input').value.trim();
            
            // 宽松验证：只检查前缀
            if (!uri.startsWith('aisi://')) {
                showError('请输入有效的 aisi:// 协议地址');
                return;
            }
            
            try {
                // 使用正确的端点
                const apiUrl = `https://aisi.gateway.workers.dev/request?uri=${encodeURIComponent(uri)}`;
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`网关响应错误: ${response.status}`);
                }
                
                const result = await response.json();
                displayResult(result);
                
            } catch (error) {
                showError(`解析失败: ${error.message}`);
            }
        }
        
        // 其他辅助函数保持不变...
    </script>
</body>
</html>
